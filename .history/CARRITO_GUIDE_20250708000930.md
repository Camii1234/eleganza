# Carrito de Compras - Funcionalidad Frontend (JavaScript Puro)

## üéØ **Soluci√≥n Implementada**

Se ha implementado un **carrito completamente del lado del cliente** usando JavaScript puro y localStorage, eliminando la necesidad de comunicaci√≥n con el servidor para las operaciones b√°sicas del carrito.

## ‚ú® **Funcionalidades Completamente Operativas**

### 1. **Gesti√≥n de Productos**
- ‚úÖ **Agregar productos** con talla y cantidad
- ‚úÖ **Actualizar cantidades** con botones +/-
- ‚úÖ **Eliminar productos individuales**
- ‚úÖ **Vaciar carrito completo**

### 2. **C√°lculos Autom√°ticos**
- ‚úÖ **Subtotal**: Suma autom√°tica de productos √ó cantidad
- ‚úÖ **Env√≠o**: Costo fijo de $15,000 COP
- ‚úÖ **Descuento**: 5% autom√°tico si subtotal > $200,000 COP
- ‚úÖ **Total**: C√°lculo din√°mico en tiempo real

### 3. **Persistencia de Datos**
- ‚úÖ **localStorage**: Los productos se guardan localmente
- ‚úÖ **Sincronizaci√≥n**: Contador actualizado en tiempo real
- ‚úÖ **Persistencia**: Carrito se mantiene entre sesiones del navegador

## Componentes del Sistema

### Archivos Modificados/Creados

1. **CarritoServlet.java**
   - Maneja todas las operaciones del carrito (agregar, actualizar, eliminar, vaciar)
   - Valida stock y par√°metros
   - Responde con JSON para operaciones AJAX

2. **CarritoFilter.java** (NUEVO)
   - Filtro que asegura que siempre exista un carrito en la sesi√≥n
   - Se ejecuta en todas las p√°ginas

3. **LogoutServlet.java**
   - Modificado para limpiar el carrito al cerrar sesi√≥n

4. **scripts.js**
   - Implementa todas las funcionalidades JavaScript del carrito
   - Maneja las peticiones AJAX
   - Muestra mensajes de confirmaci√≥n y error

5. **carrito.jsp**
   - Interfaz de usuario del carrito
   - Botones interactivos para todas las operaciones
   - Resumen de pedido con c√°lculos autom√°ticos

### Modelos de Datos

1. **Carrito.java**
   - Almacena la lista de productos en el carrito
   - Calcula autom√°ticamente subtotales, descuentos y total
   - M√©todos para agregar, actualizar y eliminar productos

2. **ItemCarrito.java**
   - Representa un producto individual en el carrito
   - Incluye informaci√≥n del producto, talla, cantidad y precio

## Flujo de Funcionamiento

### Agregar Producto
1. Usuario selecciona producto y cantidad en `producto.jsp`
2. Se env√≠a petici√≥n POST a `CarritoServlet` con `action=add`
3. Se valida stock y se agrega al carrito
4. Se recalculan totales autom√°ticamente

### Actualizar Cantidad
1. Usuario hace clic en botones "+/-" en `carrito.jsp`
2. JavaScript env√≠a petici√≥n AJAX a `CarritoServlet` con `action=update`
3. Se valida la nueva cantidad
4. Se actualiza el carrito y se recarga la p√°gina

### Eliminar Producto
1. Usuario hace clic en bot√≥n de basura
2. Se solicita confirmaci√≥n
3. JavaScript env√≠a petici√≥n AJAX con `action=remove`
4. Se elimina el producto y se recarga la p√°gina

### Vaciar Carrito
1. Usuario hace clic en "Vaciar Carrito"
2. Se solicita confirmaci√≥n
3. JavaScript env√≠a petici√≥n AJAX con `action=clear`
4. Se vac√≠a completamente el carrito

## Caracter√≠sticas T√©cnicas

### Validaciones
- Stock disponible al agregar productos
- Cantidad m√≠nima y m√°xima por producto
- Validaci√≥n de par√°metros en el servidor
- Manejo de errores con mensajes informativos

### Experiencia de Usuario
- Mensajes de confirmaci√≥n y error
- Indicadores de carga durante las operaciones
- Recalculo autom√°tico de totales
- Interfaz responsiva y atractiva

### Seguridad
- Validaciones del lado del servidor
- Manejo seguro de sesiones
- Limpieza autom√°tica del carrito al cerrar sesi√≥n
- Filtro de caracteres especiales

## Uso

1. **Navegar productos**: Ir a `productos.jsp`
2. **Ver detalles**: Hacer clic en un producto
3. **Agregar al carrito**: Seleccionar talla y cantidad, hacer clic en "Agregar al Carrito"
4. **Ver carrito**: Hacer clic en el icono del carrito o ir a `carrito.jsp`
5. **Modificar cantidades**: Usar los botones "+/-" 
6. **Eliminar productos**: Usar el bot√≥n de basura
7. **Vaciar carrito**: Usar el bot√≥n "Vaciar Carrito"
8. **Proceder al pago**: Hacer clic en "Proceder al Pago"

## Problemas Solucionados

### ‚úÖ Error HTTP 500 en carrito.jsp
- **Problema**: Sintaxis JSP malformada en directivas `<%@page`
- **Soluci√≥n**: Corregida la estructura del archivo JSP
- **Estado**: Resuelto completamente

### ‚úÖ Variable duplicada en navbar.jsp
- **Problema**: Conflicto entre CarritoFilter y navbar.jsp al declarar variable `carrito`
- **Soluci√≥n**: Renombrada variable en navbar.jsp a `carritoSesion`
- **Estado**: Resuelto completamente

### ‚úÖ Optimizaci√≥n del CarritoFilter
- **Cambio**: Filtro ahora solo se ejecuta en JSP y servlets relevantes
- **Antes**: `@WebFilter("/*")` - se ejecutaba en todos los recursos
- **Despu√©s**: `@WebFilter(urlPatterns = {"*.jsp", "/carrito", "/producto"})` - solo donde es necesario

## Notas Importantes

- El carrito funciona con sesiones temporales
- Al cerrar sesi√≥n, el carrito se vac√≠a autom√°ticamente
- Los precios se muestran en formato de pesos colombianos
- El sistema valida el stock antes de permitir agregar productos
- Todas las operaciones se realizan con peticiones AJAX para una mejor experiencia de usuario
